{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Admin Dashboard</h2>
    <a href="{{ url_for('admin.new_exam') }}" class="btn btn-primary">Create New Exam</a>
</div>

<div class="row">
    <div class="col-md-3">
        <div class="card text-white bg-info mb-3">
            <div class="card-body">
                <h5 class="card-title">Students</h5>
                <p class="card-text fs-2">{{ student_count }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title">Active Exams</h5>
                <p class="card-text fs-2">{{ exams|selectattr('is_active')|list|count }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <h3>Exams</h3>
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Title</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Adaptive</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for exam in exams %}
            <tr>
                <td>{{ exam.title }}</td>
                <td>{{ exam.duration }} mins</td>
                <td>
                    <span class="badge {{ 'bg-success' if exam.is_active else 'bg-secondary' }}">
                        {{ 'Active' if exam.is_active else 'Inactive' }}
                    </span>
                </td>
                <td>{{ 'Yes' if exam.adaptive_mode else 'No' }}</td>
                <td>
                    <a href="{{ url_for('admin.manage_questions', exam_id=exam.id) }}" class="btn btn-sm btn-info">Questions</a>
                    <button onclick="toggleExam({{ exam.id }})" class="btn btn-sm btn-warning">Toggle Status</button>
                    <a href="{{ url_for('admin.view_results', exam_id=exam.id) }}" class="btn btn-sm btn-primary">Results</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
    </div>
    <div class="col-md-4">
        <h3>Add Student</h3>
        <div class="card">
            <div class="card-body">
                <form action="{{ url_for('admin.add_student') }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="mb-2">
                        <label class="form-label">Full Name</label>
                        <input type="text" name="full_name" class="form-control" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Roll Number</label>
                        <input type="text" name="roll_number" class="form-control" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Password</label>
                        <input type="password" name="password" class="form-control" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">School ID</label>
                        <input type="text" name="school_id" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-success w-100">Add Student</button>
                </form>
            </div>
        </div>

        <h3 class="mt-4">Students</h3>
        <ul class="list-group">
            {% for student in students %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ student.full_name }} ({{ student.roll_number }})
                <span class="badge bg-primary rounded-pill">ID: {{ student.school_id }}</span>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleExam(examId) {
    fetch(`/admin/exam/${examId}/toggle`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        }
    })
    .then(res => res.json())
    .then(data => {
        if(data.status === 'success') location.reload();
    });
}
</script>
{% endblock %}
